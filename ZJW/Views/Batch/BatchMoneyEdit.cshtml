@using Model;
@{

    Layout = null;
    Property item = ViewBag.item;
    string IDs = ViewBag.IDs;
}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    @RenderPage("~/Views/Shared/Include.cshtml")
    <script src="../../Resource/edit.js"></script>

</head>
<body>
    <div class="easyui-panel" style="padding: 20px 20px;">
        @RenderPage("~/Views/Shared/upload.cshtml")
        @{Html.BeginForm("BatchSave", "Batch", FormMethod.Post, new { name = "frm_edit", id = "frm_edit" });}
        <table class="detail_table" border="0" cellspacing="1" cellpadding="0" align="center" width="100%">
            <tr class="detail_tr">
                <td class="table_title" colspan="8">
                    批量款项信息修改表<br />
                    @Html.Hidden("IDs", IDs)
                </td>
            </tr>


            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">原持有人：</td>
                <td class="detail_td2" colspan="7">@{if (Session["Flag"] == "Detail")
                { @item.OriginalHolder}
                else
                {@Html.TextBoxFor(i => item.OriginalHolder, new { size = 60 })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">款项种类：</td>
                <td class="detail_td2" colspan="7">@{if (Session["Flag"] == "Detail")
                { @item.MoneyType}
                else
                {@Html.TextBoxFor(i => item.MoneyType, new { size = 60, @class = "easyui-combobox" })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">币    种：</td>
                <td class="detail_td2" colspan="8">@{if (Session["Flag"] == "Detail")
                { @item.Currency}
                else
                {@Html.TextBoxFor(i => item.Currency, new { size = 60, @class = "easyui-combobox" })}}</td>

            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">原 账 号：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.OriginAccount}
                else
                {@Html.TextBoxFor(i => item.OriginAccount, new { size = 60 })}}</td>
                <td class="detail_td1" colspan="1">保管账号：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.KeepAccount}
                else
                {@Html.TextBoxFor(i => item.KeepAccount, new { size = 60 })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="8"></td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">暂扣时间：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.WithholdDate}
                else
                {@Html.TextBoxFor(i => item.WithholdDate, new Dictionary<string, object>() { { "size", "20" }, { "class", "easyui-datebox" }, { "data-options", "formatter:cnDateFormat,parser:cnDateParse" } })}}</td>
                <td class="detail_td1" colspan="1">承办人员：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.Undertaker}
                else
                {@Html.TextBoxFor(i => item.Undertaker, new { size = 60 })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">移交时间：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.HandOverDate}
                else
                {@Html.TextBoxFor(i => item.HandOverDate, new Dictionary<string, object>() { { "size", "20" }, { "class", "easyui-datebox" }, { "data-options", "formatter:cnDateFormat,parser:cnDateParse" } })}}</td>
                <td class="detail_td1" colspan="1">接收人员：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.Receicer}
                else
                {@Html.TextBoxFor(i => item.Receicer, new { size = 60 })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="8"></td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">处置情况：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.HandleMethod}
                else
                {@Html.TextBoxFor(i => item.HandleMethod, new { size = 60, @class = "easyui-combobox" })}}</td>
                <td class="detail_td1" colspan="1">款项性质：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.MoneyProperty}
                else
                {@Html.TextBoxFor(i => item.MoneyProperty, new { size = 60, @class = "easyui-combobox" })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="1">处置移交时间：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.HandleDate}
                else
                {@Html.TextBoxFor(i => item.HandleDate, new Dictionary<string, object>() { { "size", "20" }, { "class", "easyui-datebox" }, { "data-options", "formatter:cnDateFormat,parser:cnDateParse" } })}}</td>
                <td class="detail_td1" colspan="1">处置接收人：</td>
                <td class="detail_td2" colspan="3">@{if (Session["Flag"] == "Detail")
                { @item.HandleReveiver}
                else
                {@Html.TextBoxFor(i => item.HandleReveiver, new { size = 60 })}}</td>
            </tr>
            <tr class="detail_tr">
                <td class="table_title" colspan="8">待批处理款项清单</td>
            </tr>
            <tr class="detail_tr">
                <td class="detail_td1" colspan="8">
                    <div region="center" id="table_div" style="overflow:hidden;">
                        <table id="grid_table" align="center" style="height: auto; width: auto"></table>
                    </div>
                </td>

            </tr>


        </table>
        <p align="center">

            <a href="javascript:void(0)" class="easyui-linkbutton" id="btnLogin" iconcls="icon-ok" onclick="SubmitData()">批量修改</a>

            <a href="javascript:void(0);" class="easyui-linkbutton" id="btnLogin" iconcls="icon-ok" onclick="history.back(-1); return false;">返回</a>
        </p>

        @{Html.EndForm();}
    </div>

</body>
</html>
<script type="text/javascript">
    $(function () {
        $('#item_WithholdDate').datebox("setValue", dateParser($('#item_WithholdDate').val()));
        $('#item_HandOverDate').datebox("setValue", dateParser($('#item_HandOverDate').val()));
        $('#item_HandleDate').datebox("setValue", dateParser($('#item_HandleDate').val()));
    });

    function SubmitData() {
        if ($("#frm_edit").form('validate')) {
            $("#btnLogin").linkbutton("disable");
            $.messager.alert("操作提示", "操作成功！", "info", function (r) {
                setTimeout(function () { $('#frm_edit').submit() }, 0);
            });
        }
    }
    $(document).ready(function () {

        $("#item_MoneyType").combobox({
            url: '/json/MoneyType.json',
            valueField: 'id',
            textField: 'text',
            method: 'get',
            required: false
        });
        $("#item_Currency").combobox({
            url: '/json/Currency.json',
            valueField: 'id',
            textField: 'text',
            method: 'get',
            required: false
        });
        $("#item_HandleMethod").combobox({
            url: '/json/HandleMethod.json',
            valueField: 'id',
            textField: 'text',
            method: 'get',
            required: false
        });
        $("#item_MoneyProperty").combobox({
            url: '/json/Property.json',
            valueField: 'id',
            textField: 'text',
            method: 'get',
            required: false
        });

    });
    $(function () {

        $('#grid_table').datagrid({
            url: '/Batch/GetList?IDs=@IDs',
            sortName: 'ID',
            idField: 'ID',
            rownumbers: true,
            fit: false,
            fitColumns: true,
            frozenColumns: [[
            { field: 'ck', checkbox: false },
            ]],
            columns: [[
                 { field: 'CaseName', title: '案件名称', width: 300, sortable: true, align: 'center' },
                 { field: 'MoneyCode', title: '款项编号', width: 120, sortable: true, align: 'center' },
                 { field: 'OriginalHolder', title: '原持有人', width: 120, sortable: true, align: 'center' },
                 { field: 'Sum', title: '金额', width: 120, sortable: true, align: 'center' },
                 { field: 'Currency', title: '币 种', width: 120, sortable: true, align: 'center' },


                 {
                     field: 'WithholdDate', title: '暂扣时间', width: 120, sortable: true, align: 'center',
                     formatter: function (v, r) {
                         if (r.WithholdDate != null) {
                             var dateMilliseconds = parseInt(r.WithholdDate.replace(/\D/igm, ""));
                             var result = new Date(dateMilliseconds);
                             return result.getFullYear() + "-" + (result.getMonth() + 1) + "-" + result.getDate();
                         }
                     }
                 },
                 { field: 'HandleMethod', title: '处置方式', width: 120, sortable: true, align: 'center' },
                 { field: 'IsFinished', title: '处置状态', width: 120, sortable: true, align: 'center' },

            ]]
        });
    });
</script>





