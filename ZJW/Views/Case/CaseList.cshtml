@using Model;
@{
    
    Layout = null;
}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    @RenderPage("~/Views/Shared/Include.cshtml")
    <script src="../../Contents/public.js"></script>
    <script>
        $(function () {
            $('#grid_table').datagrid({
                url: '/Clue/GetClueList',
                sortName: 'createDate',
                idField: 'clueId',
                frozenColumns: [[
                    {
                        field: 'opt', title: '操作', width: 260, align: 'center',
                        formatter: function (v, r) {
                            var optBtn = "";

                            optBtn += ' <a class="button blue small" style="color: white;text-decoration: none;" href="/Clue/Edit?ID=' + r.ID + '" title=\"修改\">修改</a> ';
                                //optBtn += ' <a class="button blue small" style="color: white;text-decoration: none;" href="javascript:deleteClue(\'' + r.ID + '\')" title=\"删除\">删除</a> ';
    
                            optBtn += ' <a class="button blue small" style="color: white;text-decoration: none;" href="/Clue/Details?ID=' + r.ID + '" title=\"查看\">查看</a> ';

                            optBtn += ' <a class="button blue small" style="color: white;text-decoration: none;" href="/Print/Print?ID=' + r.ID + '" title=\"打印\">打印</a> ';
                            optBtn += ' <a class="button blue small" style="color: white;text-decoration: none;" href="/Approval/Create?ID=' + r.ID + '" title=\"确认打印\">录入批示</a> ';

                            return optBtn;
                        }
                    }
                ]],
                columns: [[
                     { field: 'clueCode', title: '信访编号', width: 300, sortable: true, align: 'center' },
                     { field: 'objName', title: '被反映人姓名', width: 120, sortable: true, align: 'center' },
                     { field: 'objAddress', title: '被反映人单位', width: 120, sortable: true, align: 'center' },
                     { field: 'objAdminLvl', title: '被反映人行政级别', width: 120, sortable: true, align: 'center' },
                     { field: 'reflectName', title: '反映人', width: 120, sortable: true, align: 'center' },
                     { field: 'handleDeptName', title: '当前处理部门', width: 120, sortable: true, align: 'center' },
                     { field: 'handleStaffName', title: '当前处理人员', width: 120, sortable: true, align: 'center' },
                     {
                         field: 'createDate', title: '录入时间', width: 120, sortable: true, align: 'center',
                         formatter: function (v, r) {
                             if (r.createDate != null) {
                                 var dateMilliseconds = parseInt(r.createDate.replace(/\D/igm, ""));
                                 var result = new Date(dateMilliseconds);
                                 return result.getFullYear() + "-" + (result.getMonth() + 1) + "-" + result.getDate();
                             }
                         }
                     },
                     { field: 'clueDate', title: '登记时间', width: 120, sortable: true, align: 'center' },
                     { field: 'Status', title: '状态', width: 80, sortable: true, align: 'center' }
                ]],
                toolbar: [{
                    text: '刷新',
                    iconCls: 'icon-reload',
                    handler: function () {
                        refeshGrid();
                    }
                }]
            });
            $("#queryType").combobox({
                url: '/json/clueSimple.json',
                valueField: 'id',
                textField: 'text', method: "get",
                width: 150
            });

            $("#queryFH").combobox({
                url: '/json/queryFH.json',
                valueField: 'id',
                textField: 'text', method: "get",
                width: 100
            });
        });

        function funAfterSubmit() {
            refeshGrid();
            closeMyWindow();
        }

        function funAfterDel() {
            refeshGrid();
        }

        function refeshGrid() {
            $('#grid_table').datagrid({});
        }

        function deleteClue(clueId) {
            removeObjWithConfirm(clueId, "ID", '/Clue/Delete', "funAfterDel");
        }
        function queryDataGrid() {
            var queryType = $("#queryType").combobox('getValue');
            var queryFH = $("#queryFH").combobox('getValue');
            var keyword = $('#keyword').val();
            $('#grid_table').datagrid({
                queryParams: { 'queryType': queryType, 'queryFH': queryFH, 'keyword': keyword },
                pageNumber: 1
            });
        }
    </script>
</head>
<body class="easyui-layout" style="width: 100%;height: 100%;">
    <div region="north" split="true" style="height:50px;padding:10px;">
        <form id="qry_frm" onsubmit="return false">
            <table border="0" cellpadding="0" cellspacing="0">
                <tr>
                    <td width="75" align="right">查询条件：</td>
                    <td>
                        <input id="queryType" name="queryType" class="easyui-combobox" />
                        <input id="queryFH" name="queryFH" class="easyui-combobox" />
                        <input style="width: 250px;" name="keyword" id="keyword" class="easyui-validatebox" />
                    </td>
                    <td width="75" align="right">
                        <a href="#" onclick="queryDataGrid()" plain="true" class="easyui-linkbutton" iconcls="icon-search">查询</a>
                    </td>
                    <td width="75" align="right">
                        <a href="#" onclick="$('#qry_frm')[0].reset();" plain="true" class="easyui-linkbutton" iconcls="icon-reset">清除</a>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <div region="center" id="table_div" style="overflow:hidden;">
        <form method="post" id="_frm"></form>
        <table id="grid_table"></table>
    </div>
    <div id="mywindow" class="easyui-window" closed="true" cache="false" icon="icon-save" style="width:500px;height:200px;padding:5px;background: #fafafa;">

    </div>
</body>
</html>
